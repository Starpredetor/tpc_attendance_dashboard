{% extends "base.html" %}

{% block title %}Attendance | Admin{% endblock %}

{% block content %}
<h2 style="margin-top:0;">Student Attendance Overview</h2>

<form method="get" class="toolbar card">
  <input type="text" name="q" placeholder="Search by roll no / name" value="{{ q }}" style="padding:8px;border:1px solid #ccc;border-radius:6px;min-width:220px;">

  <select name="branch" style="padding:8px;border:1px solid #ccc;border-radius:6px;min-width:160px;">
    <option value="">All Branches</option>
    {% for br in branches %}
      <option value="{{ br.id }}" {% if selected_branch == br.id|stringformat:"s" %}selected{% endif %}>{{ br.name }}</option>
    {% endfor %}
  </select>

  <select name="batch" style="padding:8px;border:1px solid #ccc;border-radius:6px;min-width:160px;">
    <option value="">All Batches</option>
    {% for bt in batches %}
      <option value="{{ bt.id }}" {% if selected_batch == bt.id|stringformat:"s" %}selected{% endif %}>{{ bt.name }}</option>
    {% endfor %}
  </select>

  <label style="display:flex;align-items:center;gap:6px;">
    <input type="checkbox" name="active" value="1" {% if active_only %}checked{% endif %}> Active only
  </label>

  <button type="submit" class="btn btn-outline">Apply Filters</button>

  <div class="spacer"></div>
  <a href="{% url 'batch_analysis_index' %}" class="btn btn-secondary">Batch-wise Analysis</a>
  <a href="{% url 'mark_attendance' %}" class="btn btn-primary">Mark Attendance</a>
</form>

<div class="card" style="overflow:auto;">
  <table class="table">
    <tr>
      <th>Roll No</th>
      <th>Name</th>
      <th>Branch</th>
      <th>Batch</th>
    </tr>

    {% for student in page_obj %}
    <tr onclick="window.location.href='{% url 'student_profile' student.id %}'">
      <td>{{ student.roll_number }}</td>
      <td>{{ student.full_name }}</td>
      <td>{{ student.branch.name }}</td>
      <td>{{ student.batch.name }}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="4">No students found</td>
    </tr>
    {% endfor %}
  </table>
</div>

<div class="pagination">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}&q={{ q }}&branch={{ selected_branch }}&batch={{ selected_batch }}&active={% if active_only %}1{% else %}0{% endif %}">Prev</a>
  {% endif %}

  <span class="active">{{ page_obj.number }}</span>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}&q={{ q }}&branch={{ selected_branch }}&batch={{ selected_batch }}&active={% if active_only %}1{% else %}0{% endif %}">Next</a>
  {% endif %}
</div>
{% endblock %}
